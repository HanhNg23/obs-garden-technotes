---
{"dg-publish":true,"dg-permalink":"spring-oauth2","permalink":"/spring-oauth2/","noteIcon":"1"}
---


# 2.5 OAuth2 

## 2.5.1 OAuth2 Overview
![](https://i.imgur.com/b9inffD.png)
<span style="color:#555555">Protocol flow - the abstract OAuth 2.0 flow illustrated in Figure above describe the interaction between the 4 roles and its steps</span>

## 2.5.2 OAuth2 Log In
- **The OAuth 2.0 Login** lets an application have **users log into the application** by **using** their **existing account** at an **OAuth 2.0 Provider - such as GITHUB |OR| OpenID Connect 1.0 Provider (such as Google)**.
### Core Configuration
- The Spring Boot provides full auto - configuration for OAuth2.0 Login.
	- See the example shows how to configure the OAuth2 Login by using Google as the Authentication Provider [See](https://docs.spring.io/spring-security/reference/servlet/oauth2/login/core.html#oauth2login-sample-initial-setup)
	- <span style="color:#d4a216">Summary</span> for implement default configuration of OAuth2 Login 
	- 1 - Completing the "**Obtain OAuth2.0 credentials**" instructions to get your app new OAuth Client with **credentials consisting of a Client ID & Client Secret**.
		- example for Google Credentials :
		   ![](https://i.imgur.com/MUa10Oq.png)
	- 2 - Setting Redirect URI - the path in the application that that the end-user's user-agent is redirected back to after they have authenticated with Google and have granted access to the OAuth Client
		- ![](https://i.imgur.com/2Sc46wp.png)
	- 3 - Configure application.yml - when you have a new OAuth Client at step 1 --> configure the application to use the OAuth Client for the authentication flow. The configuration follows the format: 
		- ![](https://i.imgur.com/Cd5xtTE.png)
	- 4 - Boot up the Application - default the Spring Boot 2.x app will be launch to go to localhost 8080 and then redirected to the default auto-generated login page which displays a link for Google. 
		- ![](https://i.imgur.com/VgirjD6.png)
- Custom more configuration for Spring Boot 2.x OAuth Client properties by following templates [See](https://docs.spring.io/spring-security/reference/servlet/oauth2/login/core.html#oauth2login-boot-property-mappings)
- CommonOAuth2Provider pre-defines
	- CommonOAuth2Provider pre-defines a set of default client properties for a number of well known providers includes: Google, GitHub, Facebook, and Okta. In addition, the authorization-uri, token-uri, user-info-uri do not change often for a provider ---> Therefore, with common Oauth2 Provider, Spring Se support default values ---> developer just set up client-id and client-secret.
		![](https://i.imgur.com/7EP0WNY.png)
	- 👕 Custom your own OAuth2Provider/registrationId - for cases where you may want to specify a different `registrationId` such as goolge-login --> *config the provider property*
		- ![](https://i.imgur.com/cgNMV88.png)
	- ![](https://i.imgur.com/jp0PwFk.png)

- Configuring Custom Provider Properties - support multi-tenancy
	- For the purpose providing supports multi-tenancy for some OAuth2.0 Provider require.
	- `Multi-tenancy` - means using different protocol endpoints for each tenant/sub-model.
		For example: an OAuth Client registration with Okta is assigned to a specific sub-domain and have their own protocol endpoints.
	- 👕 Let go to config custom provider properties: `spring.security.oauth2.client.provider._[providerId]_`
		- ![](https://i.imgur.com/wPjyCVE.png)
- Overriding Spring Boot 2.x Auto-Configuration
	- The auto-configuration class for <span style="color:#00b0f0">**OAuth Client support is `OAuth2ClientAutoConfiguration`. Performing the following tasks:**</span>
		- <span style="color:#00b0f0">Registers a `ClientRegistrationRepository` `@Bean` which composed of `ClientRegistration`(s) (like Github, Facebook, ... other OAuth2 Providers) from OAuth Client properties.</span>
		- <span style="color:#00b0f0">Registers a `SecurityFilterChain` @Bean and enables OAuth2.0 Login through `httpSecurity.oauth2Login()`</span>
			- ![](https://i.imgur.com/m3X7nMo.png)
		-  ⭐ To Override the auto-configuration --> do so in the following ways: 
			- [Register a ClientRegistrationRepository @Bean](https://docs.spring.io/spring-security/reference/servlet/oauth2/login/core.html#oauth2login-register-clientregistrationrepository-bean)
			- [Register a SecurityFilterChain @Bean](https://docs.spring.io/spring-security/reference/servlet/oauth2/login/core.html#oauth2login-provide-securityfilterchain-bean)
			- [Completely Override the Auto-configuration](https://docs.spring.io/spring-security/reference/servlet/oauth2/login/core.html#oauth2login-completely-override-autoconfiguration)
	- Java Configuration without Spring Boot 2.x - if you not able to use Spring Boot 2.x and would like to configure one of the pre-defined providers in CommonOAuth2Provider like Google for ex -> [See](https://docs.spring.io/spring-security/reference/servlet/oauth2/login/core.html#oauth2login-javaconfig-wo-boot)
 